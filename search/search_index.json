{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"Welcome to Tetrate Tech Talks, a weekly livestream where we feature a conversation with a guest to discuss technology, technical demonstrations and more. Tetrate is the enterprise service mesh company. Much of our focus is on service meshes, Istio, Envoy, Kubernetes and more. But we won't shy away from topics that are further afield. There's plenty to talk about! Our first episode is scheduled took place on April 1 2022. Here is the link to the YouTube Playlist for Tetrate's Tech Talks. Upcoming Episodes \u00b6 Stay tuned as we line up guests and topics in the coming weeks! Past Episodes: \u00b6 Episode 1 - Friday April 1 2022, 9:00 Pacific time (1 hr).","title":"Home"},{"location":"#upcoming-episodes","text":"Stay tuned as we line up guests and topics in the coming weeks!","title":"Upcoming Episodes"},{"location":"#past-episodes","text":"Episode 1 - Friday April 1 2022, 9:00 Pacific time (1 hr).","title":"Past Episodes:"},{"location":"episode1/","text":"Episode 1 \u00b6 Your Host: Eitan Suez \u00b6 Eitan will be hosting this episode from Austin, Texas. Topic: How to connect VM workloads to Istio Mesh \u00b6 There's much to explore about service meshes. Istio deployments run on Kubernetes, but did you know that you can expand the mesh to include applications running on VMs? We begin the episode with a demonstration of how to add a VM to your Istio mesh, based on the terrific Istio documentation . Eitan will be running the demonstration. If you'd like to follow along, the instructions are here . Guest: Bart Van Bos \u00b6 Bart is a Tetrand living and working in Belgium. Bart has experience working with customers and integrating service meshes in the enterprise. Bring your questions! When \u00b6 Friday 2022.04.01 @ 9:00 AM Pacific time","title":"Description"},{"location":"episode1/#episode-1","text":"","title":"Episode 1"},{"location":"episode1/#your-host-eitan-suez","text":"Eitan will be hosting this episode from Austin, Texas.","title":"Your Host: Eitan Suez"},{"location":"episode1/#topic-how-to-connect-vm-workloads-to-istio-mesh","text":"There's much to explore about service meshes. Istio deployments run on Kubernetes, but did you know that you can expand the mesh to include applications running on VMs? We begin the episode with a demonstration of how to add a VM to your Istio mesh, based on the terrific Istio documentation . Eitan will be running the demonstration. If you'd like to follow along, the instructions are here .","title":"Topic:  How to connect VM workloads to Istio Mesh"},{"location":"episode1/#guest-bart-van-bos","text":"Bart is a Tetrand living and working in Belgium. Bart has experience working with customers and integrating service meshes in the enterprise. Bring your questions!","title":"Guest: Bart Van Bos"},{"location":"episode1/#when","text":"Friday 2022.04.01 @ 9:00 AM Pacific time","title":"When"},{"location":"episode1/presentation/","text":"About Tetrate Tech Talks \u00b6 A new series of broadcasts that runs every Friday at 9:00 AM Pacific streamed to YouTube and to LinkedIn Live. Objectives: learning and sharing knowledge getting to know the diverse members of the service mesh community have fun! Episodes present a technical topic and feature a guest. Meet our CEO, Varun Talwar \u00b6 Varun, meet the Service Mesh community! q: In your own words.. what this new broadcast series is all about? I'm your host, Eitan Suez \u00b6 I work at Tetrate, and I like to talk tech. A little bit about myself and my background.. I've spent a lot of time in the last few years doing a lot of technical explaining: technical education, training, in-person, online, conference training, and more. My background has a long tail so to speak, I started out as an electrical engineer turned software engineer. An abbreviated history.. was gung ho about the web in the years when netscape announced its browser. Did a lot of Java and Javascript, startups in the late 90's and early 2000's, user group community stuff, conference speaking, Groovy, Spring, consulting, to education. Moved from dev to ops with cloud foundry and bosh, then to Kubernetes and now to all things service mesh. You'll have plenty of opportunity to get to know me in this and upcoming episodes! Tetrate Tech Talks web page \u00b6 https://tetratelabs.github.io/tetrate-tech-talks/ \u00b6 Free Workshops! \u00b6 Istio 0 to 60 (May 4) WASM (April 20) We run these workshops periodically. But the lab materials are free and available for you to work through (and contribute to) at any time. Upcoming Industry Events \u00b6 IstioCon 2022 , April 25-29 I hope to be conducting a workshop.. Istio 0 to 60. Join me! ServiceMeshCon & KubeCon EU , May 16 + 17-20 Tetrate will be running its own one-day event with keynotes, talks, and announcements. Stay tuned for more information on that. Come join us in Valencia, Spain! Austin Roadshow - April 21 Stay tuned for more information on that event as well. Join the conversation.. \u00b6 ..on our Slack channel : https://tetrate-community.slack.com/ \u00b6 Finally.. the episode \u00b6 What are we going to learn? How to connect VM workloads to Istio Mesh Our Guest: Bart Van Bos Let's get started .. Did I mention.. join the conversation? \u00b6 https://tetrate-community.slack.com/","title":"Presentation"},{"location":"episode1/presentation/#about-tetrate-tech-talks","text":"A new series of broadcasts that runs every Friday at 9:00 AM Pacific streamed to YouTube and to LinkedIn Live. Objectives: learning and sharing knowledge getting to know the diverse members of the service mesh community have fun! Episodes present a technical topic and feature a guest.","title":"About Tetrate Tech Talks"},{"location":"episode1/presentation/#meet-our-ceo-varun-talwar","text":"Varun, meet the Service Mesh community! q: In your own words.. what this new broadcast series is all about?","title":"Meet our CEO, Varun Talwar"},{"location":"episode1/presentation/#im-your-host-eitan-suez","text":"I work at Tetrate, and I like to talk tech. A little bit about myself and my background.. I've spent a lot of time in the last few years doing a lot of technical explaining: technical education, training, in-person, online, conference training, and more. My background has a long tail so to speak, I started out as an electrical engineer turned software engineer. An abbreviated history.. was gung ho about the web in the years when netscape announced its browser. Did a lot of Java and Javascript, startups in the late 90's and early 2000's, user group community stuff, conference speaking, Groovy, Spring, consulting, to education. Moved from dev to ops with cloud foundry and bosh, then to Kubernetes and now to all things service mesh. You'll have plenty of opportunity to get to know me in this and upcoming episodes!","title":"I'm your host, Eitan Suez"},{"location":"episode1/presentation/#tetrate-tech-talks-web-page","text":"","title":"Tetrate Tech Talks web page"},{"location":"episode1/presentation/#httpstetratelabsgithubiotetrate-tech-talks","text":"","title":"https://tetratelabs.github.io/tetrate-tech-talks/"},{"location":"episode1/presentation/#free-workshops","text":"Istio 0 to 60 (May 4) WASM (April 20) We run these workshops periodically. But the lab materials are free and available for you to work through (and contribute to) at any time.","title":"Free Workshops!"},{"location":"episode1/presentation/#upcoming-industry-events","text":"IstioCon 2022 , April 25-29 I hope to be conducting a workshop.. Istio 0 to 60. Join me! ServiceMeshCon & KubeCon EU , May 16 + 17-20 Tetrate will be running its own one-day event with keynotes, talks, and announcements. Stay tuned for more information on that. Come join us in Valencia, Spain! Austin Roadshow - April 21 Stay tuned for more information on that event as well.","title":"Upcoming Industry Events"},{"location":"episode1/presentation/#join-the-conversation","text":"..on our Slack channel :","title":"Join the conversation.."},{"location":"episode1/presentation/#httpstetrate-communityslackcom","text":"","title":"https://tetrate-community.slack.com/"},{"location":"episode1/presentation/#finally-the-episode","text":"What are we going to learn? How to connect VM workloads to Istio Mesh Our Guest: Bart Van Bos Let's get started ..","title":"Finally.. the episode"},{"location":"episode1/presentation/#did-i-mention-join-the-conversation","text":"https://tetrate-community.slack.com/","title":"Did I mention.. join the conversation?"},{"location":"episode1/demo/","text":"Connect VM Workloads to Istio mesh \u00b6 This document is a recipe illustrating Istio mesh expansion using a single network and a single cluster. We install Istio and deploy all BookInfo services to the mesh, with the exception of the ratings service, which will run separately on a VM. The idea is to make this work, and thereby to demonstrate that Istio supports a mesh where some services run in-cluster and some outside it. The artifacts referenced in these instructions can be obtained from the GitHub repository for this site. Prerequisites \u00b6 A GCP or other cloud account Create K8s Cluster \u00b6 ./scripts/make-gke-cluster Wait until cluster is ready. Create the VM \u00b6 gcloud compute instances create my-mesh-vm --tags = mesh-vm \\ --machine-type = n1-standard-2 \\ --network = default --subnet = default \\ --image-project = ubuntu-os-cloud \\ --image = ubuntu-2110-impish-v20220309 Install ratings app on the VM \u00b6 Wait for the machine to be ready. Copy over the ratings app gcloud compute scp --recurse bookinfo/ratings ubuntu@my-mesh-vm:ratings ssh onto the VM gcloud compute ssh ubuntu@my-mesh-vm Install nodejs, the ratings app and start it, test it. sudo apt-get update sudo apt-get install nodejs npm Install dependencies cd ratings/ npm install Run the app: node ratings.js 9080 & Test the app. Retrieve a rating. curl http://localhost:9080/ratings/123 Allow POD-to-VM traffic on port 9080 \u00b6 CLUSTER_POD_CIDR = $( gcloud container clusters describe my-istio-cluster --format = json | jq -r '.clusterIpv4Cidr' ) gcloud compute firewall-rules create \"cluster-pods-to-vm\" \\ --source-ranges = $CLUSTER_POD_CIDR \\ --target-tags = mesh-vm \\ --action = allow \\ --rules = tcp:9080 Install Istio \u00b6 istioctl install \\ --set values.pilot.env.PILOT_ENABLE_WORKLOAD_ENTRY_AUTOREGISTRATION = true \\ --set values.pilot.env.PILOT_ENABLE_WORKLOAD_ENTRY_HEALTHCHECKS = true Deploy BookInfo (sans ratings) \u00b6 Turn on sidecar-injection. k label ns default istio-injection = enabled Deploy the reviews service. k apply -f bookinfo/bookinfo-reviews.yaml Important: the reviews service uses an environment variable named SERVICES_DOMAIN that we use to adjust the ratings app target url to reflect the fact that it resides in a different namespace. Deploy the remaining services. k apply -f bookinfo/bookinfo-rest.yaml Install east-west gateway and expose Istiod \u00b6 Control plane traffic between the VM and istiod goes through this gateway (see the Istio documentation ). Install the gateway ./scripts/gen-eastwest-gateway.sh --single-cluster | istioctl install -y -f - Expose istiod k apply -n istio-system -f ./artifacts/expose-istiod.yaml Create the ratings namespace and service account \u00b6 The ratings service running on the VM will map to the ratings namespace in kubernetes. k create namespace ratings k create serviceaccount bookinfo-ratings -n ratings Create the WorkloadGroup \u00b6 A WorkloadGroup is a template for WorkloadEntity objects, see the Istio reference . istioctl x workload group create \\ --name \"ratings\" \\ --namespace \"ratings\" \\ --labels app = \"ratings\" \\ --serviceAccount \"bookinfo-ratings\" > workloadgroup.yaml Apply the workloadgroup: k apply -f workloadgroup.yaml -n ratings Generate VM artifacts \u00b6 istioctl x workload entry configure -f workloadgroup.yaml -o vm_files --autoregister Note: check that vm_files/hosts is not blank. If it is, it means you ran the command too soon. Re-run it. VM configuration recipe \u00b6 Copy the generated artifacts to the VM. gcloud compute scp vm_files/* ubuntu@my-mesh-vm: Ssh onto the VM gcloud compute ssh ubuntu@my-mesh-vm And, on the VM, run the following commands (taken from here ). sudo mkdir -p /etc/certs sudo cp ~/root-cert.pem /etc/certs/root-cert.pem sudo mkdir -p /var/run/secrets/tokens sudo cp ~/istio-token /var/run/secrets/tokens/istio-token curl -LO https://storage.googleapis.com/istio-release/releases/1.13.2/deb/istio-sidecar.deb sudo dpkg -i istio-sidecar.deb sudo cp ~/cluster.env /var/lib/istio/envoy/cluster.env sudo cp ~/mesh.yaml /etc/istio/config/mesh sudo sh -c 'cat $(eval echo ~$SUDO_USER)/hosts >> /etc/hosts' sudo mkdir -p /etc/istio/proxy sudo chown -R istio-proxy /etc/certs /var/run/secrets /var/lib/istio /etc/istio/config /etc/istio/proxy Exercise 1 \u00b6 Watch the WorkloadEntry get created as a consequence of the VM registering with the mesh. k get workloadentry -n ratings -w On the VM: sudo systemctl start istio Notice the workload entry show up in the listing. This can take up to a minute. Exercise 2 \u00b6 Although the ratings services does not need to call back into the mesh, we can manually test communication from the VM into the mesh. From the VM, run: curl details.default.svc:9080/details/123 Exercise 3 \u00b6 Test communication from a pod to the ratings service running on the VM. Create a ClusterIP service to front the application: k apply -n ratings -f bookinfo/bookinfo-ratings-service.yaml Create a temporary client pod in the default namespace k run curlpod --image = radial/busyboxplus:curl -it --rm From within the container, run the curl command: curl ratings.ratings:9080/ratings/123 Finally, exit the container. Put it all together \u00b6 Expose BookInfo: k apply -f bookinfo/bookinfo-gateway.yaml Grab your load balancer public IP address: GATEWAY_IP = $( kubectl get svc -n istio-system istio-ingressgateway -ojsonpath = '{.status.loadBalancer.ingress[0].ip}' ) Open a browser and visit the BookInfo product page (at /productpage). Verify that you can see ratings on the page. curl $GATEWAY_IP /productpage References \u00b6 Istio VM Architecture Basic recipe from the Istio docs GCP-specific information on mesh expansion (dated)","title":"Demo"},{"location":"episode1/demo/#connect-vm-workloads-to-istio-mesh","text":"This document is a recipe illustrating Istio mesh expansion using a single network and a single cluster. We install Istio and deploy all BookInfo services to the mesh, with the exception of the ratings service, which will run separately on a VM. The idea is to make this work, and thereby to demonstrate that Istio supports a mesh where some services run in-cluster and some outside it. The artifacts referenced in these instructions can be obtained from the GitHub repository for this site.","title":"Connect VM Workloads to Istio mesh"},{"location":"episode1/demo/#prerequisites","text":"A GCP or other cloud account","title":"Prerequisites"},{"location":"episode1/demo/#create-k8s-cluster","text":"./scripts/make-gke-cluster Wait until cluster is ready.","title":"Create K8s Cluster"},{"location":"episode1/demo/#create-the-vm","text":"gcloud compute instances create my-mesh-vm --tags = mesh-vm \\ --machine-type = n1-standard-2 \\ --network = default --subnet = default \\ --image-project = ubuntu-os-cloud \\ --image = ubuntu-2110-impish-v20220309","title":"Create the VM"},{"location":"episode1/demo/#install-ratings-app-on-the-vm","text":"Wait for the machine to be ready. Copy over the ratings app gcloud compute scp --recurse bookinfo/ratings ubuntu@my-mesh-vm:ratings ssh onto the VM gcloud compute ssh ubuntu@my-mesh-vm Install nodejs, the ratings app and start it, test it. sudo apt-get update sudo apt-get install nodejs npm Install dependencies cd ratings/ npm install Run the app: node ratings.js 9080 & Test the app. Retrieve a rating. curl http://localhost:9080/ratings/123","title":"Install ratings app on the VM"},{"location":"episode1/demo/#allow-pod-to-vm-traffic-on-port-9080","text":"CLUSTER_POD_CIDR = $( gcloud container clusters describe my-istio-cluster --format = json | jq -r '.clusterIpv4Cidr' ) gcloud compute firewall-rules create \"cluster-pods-to-vm\" \\ --source-ranges = $CLUSTER_POD_CIDR \\ --target-tags = mesh-vm \\ --action = allow \\ --rules = tcp:9080","title":"Allow POD-to-VM traffic on port 9080"},{"location":"episode1/demo/#install-istio","text":"istioctl install \\ --set values.pilot.env.PILOT_ENABLE_WORKLOAD_ENTRY_AUTOREGISTRATION = true \\ --set values.pilot.env.PILOT_ENABLE_WORKLOAD_ENTRY_HEALTHCHECKS = true","title":"Install Istio"},{"location":"episode1/demo/#deploy-bookinfo-sans-ratings","text":"Turn on sidecar-injection. k label ns default istio-injection = enabled Deploy the reviews service. k apply -f bookinfo/bookinfo-reviews.yaml Important: the reviews service uses an environment variable named SERVICES_DOMAIN that we use to adjust the ratings app target url to reflect the fact that it resides in a different namespace. Deploy the remaining services. k apply -f bookinfo/bookinfo-rest.yaml","title":"Deploy BookInfo (sans ratings)"},{"location":"episode1/demo/#install-east-west-gateway-and-expose-istiod","text":"Control plane traffic between the VM and istiod goes through this gateway (see the Istio documentation ). Install the gateway ./scripts/gen-eastwest-gateway.sh --single-cluster | istioctl install -y -f - Expose istiod k apply -n istio-system -f ./artifacts/expose-istiod.yaml","title":"Install east-west gateway and expose Istiod"},{"location":"episode1/demo/#create-the-ratings-namespace-and-service-account","text":"The ratings service running on the VM will map to the ratings namespace in kubernetes. k create namespace ratings k create serviceaccount bookinfo-ratings -n ratings","title":"Create the ratings namespace and service account"},{"location":"episode1/demo/#create-the-workloadgroup","text":"A WorkloadGroup is a template for WorkloadEntity objects, see the Istio reference . istioctl x workload group create \\ --name \"ratings\" \\ --namespace \"ratings\" \\ --labels app = \"ratings\" \\ --serviceAccount \"bookinfo-ratings\" > workloadgroup.yaml Apply the workloadgroup: k apply -f workloadgroup.yaml -n ratings","title":"Create the WorkloadGroup"},{"location":"episode1/demo/#generate-vm-artifacts","text":"istioctl x workload entry configure -f workloadgroup.yaml -o vm_files --autoregister Note: check that vm_files/hosts is not blank. If it is, it means you ran the command too soon. Re-run it.","title":"Generate VM artifacts"},{"location":"episode1/demo/#vm-configuration-recipe","text":"Copy the generated artifacts to the VM. gcloud compute scp vm_files/* ubuntu@my-mesh-vm: Ssh onto the VM gcloud compute ssh ubuntu@my-mesh-vm And, on the VM, run the following commands (taken from here ). sudo mkdir -p /etc/certs sudo cp ~/root-cert.pem /etc/certs/root-cert.pem sudo mkdir -p /var/run/secrets/tokens sudo cp ~/istio-token /var/run/secrets/tokens/istio-token curl -LO https://storage.googleapis.com/istio-release/releases/1.13.2/deb/istio-sidecar.deb sudo dpkg -i istio-sidecar.deb sudo cp ~/cluster.env /var/lib/istio/envoy/cluster.env sudo cp ~/mesh.yaml /etc/istio/config/mesh sudo sh -c 'cat $(eval echo ~$SUDO_USER)/hosts >> /etc/hosts' sudo mkdir -p /etc/istio/proxy sudo chown -R istio-proxy /etc/certs /var/run/secrets /var/lib/istio /etc/istio/config /etc/istio/proxy","title":"VM configuration recipe"},{"location":"episode1/demo/#exercise-1","text":"Watch the WorkloadEntry get created as a consequence of the VM registering with the mesh. k get workloadentry -n ratings -w On the VM: sudo systemctl start istio Notice the workload entry show up in the listing. This can take up to a minute.","title":"Exercise 1"},{"location":"episode1/demo/#exercise-2","text":"Although the ratings services does not need to call back into the mesh, we can manually test communication from the VM into the mesh. From the VM, run: curl details.default.svc:9080/details/123","title":"Exercise 2"},{"location":"episode1/demo/#exercise-3","text":"Test communication from a pod to the ratings service running on the VM. Create a ClusterIP service to front the application: k apply -n ratings -f bookinfo/bookinfo-ratings-service.yaml Create a temporary client pod in the default namespace k run curlpod --image = radial/busyboxplus:curl -it --rm From within the container, run the curl command: curl ratings.ratings:9080/ratings/123 Finally, exit the container.","title":"Exercise 3"},{"location":"episode1/demo/#put-it-all-together","text":"Expose BookInfo: k apply -f bookinfo/bookinfo-gateway.yaml Grab your load balancer public IP address: GATEWAY_IP = $( kubectl get svc -n istio-system istio-ingressgateway -ojsonpath = '{.status.loadBalancer.ingress[0].ip}' ) Open a browser and visit the BookInfo product page (at /productpage). Verify that you can see ratings on the page. curl $GATEWAY_IP /productpage","title":"Put it all together"},{"location":"episode1/demo/#references","text":"Istio VM Architecture Basic recipe from the Istio docs GCP-specific information on mesh expansion (dated)","title":"References"}]}